---
title: Command Line Tools
summary: Quick descriptions of program I use often during my normal work, and also some network focused tools I encountered for the first time when working on rotation with our Information Services team.
---

# Filesystem

### [ls](http://man7.org/linux/man-pages/man1/ls.1.html)
`-s` shows allocated blocks.\
`-a` shows all, `-A` shows all except . and ..\
`-l` shows long detail.\
`-h` shows human readable sizes.\
`-1` ouputs one directory entry per line.\
`-d` stats a directory rather than its contents.\
`-t` sort output to show most recently modified first.\
`-u` sort by last access time instead of last modified time.


### [mv](http://man7.org/linux/man-pages/man1/mv.1.html)
Sometimes thought of as being an atomic `cp`/`rm` but isn't really.
Within a single filesystem, `mv` is generally a call to `rename()`, which is atomic.
It removes an i-node reference from the directory block of the source and adds it to that of the target.

### [chmod](http://man7.org/linux/man-pages/man1/chmod.1.html)
Change mode of files and directories. Mode consists of **r**ead, **w**rite, e**x**ecute/search, **s**et uid/gid, s**t**icky, and is set for **u**ser, **g**roup, **o**ther and **a**ll.
Multiple clauses can be used in a single invocation e.g.

	chmod a+r,go-wx foo

### [chown](http://man7.org/linux/man-pages/man1/chown.1.html)

	chown bhyland:wheel foo

`-R` for recursive\
`--from=owner:group` to filter on current owner/group
	
### [ln](http://man7.org/linux/man-pages/man1/ln.1.html)
Create hard links or symbolic links. A hard link is just another directory entry to an existing i-node. A symbolic link is a special file that links indirectly to the target i-node. It can link across filesystems and to directories as well as files. A symbolic link is not included in the link count of the target, and can point to targets that don't exist.
	
	ln target link

`-s` for a symbolic link.\
`-f` to attempt to remove existing files with the same name as the link (force).

### [mktemp](http://man7.org/linux/man-pages/man1/mktemp.1.html)
Safely create temporary files, avoiding various security related race conditions. Files are created with **rw** for the owner only. Not to be confused with the unsafe [mktemp](http://man7.org/linux/man-pages/man3/mktemp.3.html) function, which was replaced by [mkstemp](http://man7.org/linux/man-pages/man3/mkstemp.3.html).

	mktemp foo/bar.XXXXX

`-d` to create a directory.

### [flock](http://man7.org/linux/man-pages/man1/flock.1.html)
`flock` handles file locks, quite an easy way to do critical sections in scripts.\
You can lock a file by name or descriptor. The lock is released when the file is closed.

`-x` for exclusive lock.\
`-s` for shared lock.\
`-w seconds` to fail if the lock is not available after the given timeout.\
`-n` to fail immediately if the lock is not available.

### [dirname](http://man7.org/linux/man-pages/man1/dirname.1.html)/[basename](http://man7.org/linux/man-pages/man1/basename.1.html)
`dirname` outputs the containing directory of the file or directory represented by the given path.

`basename` outputs the name of the file or directory represented by the given path with the path of containing directories removed.

### [readlink](http://man7.org/linux/man-pages/man1/readlink.1.html)
`readlink -f` gives the canonical filesystem path generated by recursively resolving all symbolic links in the given path.

### pushd/popd/dirs
These are [bash builtins](http://man7.org/linux/man-pages/man1/bash.1.html#SHELL_BUILTIN%20COMMANDS) for changing and remembering the working directory.

`pushd directory` adds `directory` to the stack and makes it the current working directory.\
`popd` removes a directory from the top of the stack and makes it the current working directory.\
Both take `-n` to suppress the cd.

`dirs` displays the stack.\
`-l` for full pathnames.\
`-p` for one entry per line.\
`-c` to clear the stack.

`pushd` and `popd` display the new stack if successful, so some scripts will need to redirect their output.

### [dd](http://man7.org/linux/man-pages/man1/dd.1.html)
Streams input to output, and can perform some filtering and transformations.
There are some amusing [competing origin stories](http://www.roesler-ac.de/wolfram/acro/credits.htm#1) for the name.

One way to tie up a core:

	dd if=/dev/zero of=/dev/null

More [examples from Noah Spurrier](http://www.noah.org/wiki/Dd_-_Destroyer_of_Disks).

### [truncate](http://man7.org/linux/man-pages/man1/truncate.1.html)
Change a file's size. If the size is extended, no new blocks are allocated; you get a file hole instead.

	truncate -s 42m foo

### [vim](http://vimdoc.sourceforge.net/)
[Cheat sheet](http://www.fprintf.net/vimCheatSheet.html).

Stuff I need to remember:

`"+p` to paste from Ctrl+C buffer, `"*p` to paste from hilight buffer (usually).\
`:%s/foo/bar/g` for substitution.\
`u` for undo, `Ctrl+R` for redo.\
`~` to toggle case.\
`:set paste`/`:set nopaste` to paste large chunks without autoindent messing up the indentation.

### [less](http://linux.die.net/man/1/less)
Doesn't need to load the whole file before displaying some of it.

`F` follows file.\
`/foo` searches, `n` next, `N` previous.\
`&foo` hides non-matching lines (awesome!).\
`less -r` allows raw characters, which among other things allows ansi colour to display properly.\
`!` before a search negates the match.

### [tail](http://man7.org/linux/man-pages/man1/tail.1.html)
`-f` follows file by descriptor.\
`-F` follows file by name.

### [head](http://man7.org/linux/man-pages/man1/head.1.html)
`-n num` shows the first `num` lines of the given file.\
Combine with `tail` to pick out the interesting bit from the middle of a file:
	
	<foo head -n 30000 | tail -n -50

### [od](http://man7.org/linux/man-pages/man1/od.1.html)
Useful for examining small file fragments for oddities, such as malformed unicode, smashed arrays, messed up line endings.

### [xxd](http://linux.die.net/man/1/xxd)
Dump or recover file as hex (or binary).

For manual view with offsets and ascii:

	xxd -cols 64 foo

Dump and recover plain hex:

	xxd -p foo > out
	xxd -p -r out > foo2

### [tar](http://man7.org/linux/man-pages/man1/tar.1.html)
Create archives:

	tar cvf foo.tar foo/
	tar cvzf foo.tar.gz foo/
	tar cvjf foo.tar.bz2 foo/

Extract archives:

	tar xvf foo.tar
	tar xvzf foo.tar.gz
	tar xvjf foo.tar.bz2

### [find](http://man7.org/linux/man-pages/man1/find.1.html)
Search for files and do things to them.

There are a bunch of filter options; by default these form a conjunction but be combined with `-or` clauses and parentheses if more complex filters are needed.

For example: find files and directories under the current working directory having a `basename` starting with `foo`, and also find files having `bar` somewhere in their path which had their content modified within the last hour and are greater than 50 megabytes in size.

	find . -name 'foo*' -o \( -mtime -60m -path '*bar*' -type f -size +50M \)

Find can also invoke commands on its results.

`-exec command arg '{}' ';'` will execute command once for each result. `{}` are replaced with the path to the current target, `;` signifies the end of `command`'s arguments. `-exec command arg '{}' '+'` does the same but builds up a list of results to reduce the number of `command` invocations. There could be more than one invocation if the number of results is large enough to run over the maximum command length. Since the command is built by appending results, there cannot be any args between `{}` and `+`.

	find . ! -path './build*' -name '*.log' -exec tar cvf ~/logs.tar '{}' '+'

# Remoting

### [ssh](http://man7.org/linux/man-pages/man1/ssh.1.html)
Lots more to use and abuse here. Most of the time, I only need a small amount of the real ultimate power available. This is fortunate since I don't know ssh at all well.

`-A` forwards agent authentication to the remote host.\
`-L` and `-R` are for port forwarding, and take additional options to describe the tunnel.\
`-N` avoids running any remote command.\
`-T` avoids allocating a remote terminal.\
`-f` sends ssh to the background just before it runs any commands (but after it asks for passwords).\
`-l` sets login name.\
`-p` sets remote port.\
`-v` for debugging - just add `-v`s until the error messages start to make sense or you run out of keyboard.\
`-X` and `-Y` are for normal and trusted X forwarding.

Generate a new keypair with `ssh-keygen -t rsa -C 'public comment, e.g. email address or name'`.
The private key is generated in `~/.ssh/id_rsa` and the public key in `~/.ssh/id_rsa.pub`.

Supply the public key to appropriate hosts by appending it to `~/.ssh/authorized_keys` or using [ssh-copy-id](http://linux.die.net/man/1/ssh-copy-id), which also ensures file permissions are correct.

`ssh-add` can be used to add keys, or check what keys have been added, or check whether an agent is accessible.\
This can be useful in scripts that need to pre-authorise as they start up.

Some forwarding rules in the config file can save typing if you have a segregated network and regularly need to go via jump hosts.

### [scp](http://man7.org/linux/man-pages/man1/scp.1.html)

	scp user@sourcehost:/path/to/source user@targethost:/path/to/target

`-r` for recursive directory copy.\
`-l kbits` for rate limit of `kbits` per second.

### [rsync](http://linux.die.net/man/1/rsync)
rsync is a very flexible program for remote copying that I've so far tended only to use for backup or syncing.

`-H` preserves hard links.\
`-A` preserves ACLs.\
`-X` preserves extended attributes.\
`-a` archive mode: recursively copy subdirectories, preserves symbolic links, permissions, owner, group, times.\
`--delete` cleans the target.\
`--exclude-from=file` specifies file containing patterns to ignore.

### [curl](http://curl.haxx.se/docs/manpage.html)
Useful for scripted downloads and for command line testing of http apis.

`-H` adds a header.\
`-c` specifies cookie file to write to.\
`-b` specifies cookie file to read from.\
`-d` sends POST data. Other options exist for sending binary or url encoded data, reading from a file, sending form data, multipart data and so on.\
`-I` http HEAD.\
`-L` follows redirects.\
`-r` request a byte range.\
`-T` upload files with PUT.\
`-s` silent mode.

### [wget](http://www.gnu.org/software/wget/manual/wget.html)
The main use case for `wget` over `curl` is recursively downloading directories of files, following links in dowloaded documents, and coverting links for local use.

# Networks

### [ping](http://man7.org/linux/man-pages/man8/ping.8.html)
Ping tests connectivity via [ICMP](http://man7.org/linux/man-pages/man7/icmp.7.html).
Depending on firewall rules, it is possible for a host reachable by ping to be unreachable by other means (e.g. tcp).

### [traceroute](http://man7.org/linux/man-pages/man8/traceroute.8.html)
traceroute sends out several ip messages with varying TTL. Since each hop in a route decrements the TTL and a host sends a 'TTL exceeded' message if it sees a TTL of 0, traceroute can figure out the route taken to a given host and the transit time for the various hops involved.

### telnet
For remote command line, prefer ssh. Since the telnet protocol isn't quite the same as raw tcp and we prefer to avoid suprises, for remote tcp debugging, prefer netcat/socat.

### [nc](http://linux.die.net/man/1/nc)
As per the [page for the original nc 1.10](http://nc110.sourceforge.net/), netcat is supposed to be a swiss army knife for tcp/ip. The original is no longer maintained but there are many ports and reimplementations that are. It's often sensible to choose netcat instead of the more powerful socat since netcat has a simpler interface.

Listen on a port and emit data received to file. After each connection completes, wait for another client to connect:

	nc -l -k port > file

Open a connection to a server, and transmit data received on stdin over the connection. The connection is terminated at the end of the input (e.g. Ctrl+D for EOT, in a terminal):

	nc host port

`-u` uses udp instead of tcp.

### [socat](http://www.dest-unreach.org/socat/doc/socat.html)
`socat` allows full duplex communication between two channels, handling the necessary config and protocol for you. A channel could be a file, pipe, device, various kinds of socket, or another program. Lots to learn here but it seems like a good starting point for any one-off task that needs bidirectional integration hackery.

### [ifconfig](http://man7.org/linux/man-pages/man8/ifconfig.8.html)
Examine and configure network interfaces. Prefer `ip` et al where they are available.

`ifconfig -a` shows status of all interfaces.\
`ifconfig eth0` shows status of interface named eth0 only.\
`ifconfig eth0 option` sets option for interface named eth0 (e.g. up/down, broadcast, multicast, address).

### [ip](http://linux.die.net/man/8/ip)
`ip` is the main tool in the [iproute2](http://www.linuxfoundation.org/collaborate/workgroups/networking/iproute2) suite, which replaces ifconfig, among other things. Most commands now follow a common pattern:

	ip object verb

Objects are things like `addr`, `link`, `route`.\
Verbs are commands specific to the object, like `show`, `add`, `del`.

### [iw](http://linux.die.net/man/8/iw)
`iw` is the iproute2 tool for handling wireless devices. Haven't used it yet as I'm currently running FreeBSD on my laptop and iproute2 is linux-only.

### [ss](http://linux.die.net/man/8/ss)
Examine sockets. Replaces `netstat` where available.

`-t` shows tcp sockets.\
`-u` shows udp sockets.\
`-p` shows process associated with each socket.\
`-n` shows numeric addresses without resolving them.\
`-o`, `-i`, `-e`, `-m`, `-s` shows various forms of info associated with each socket.

### [lldpctl](http://vincentbernat.github.io/lldpd/usage.html)
Each interface on a device sends [LLDP](http://en.wikipedia.org/wiki/Link_Layer_Discovery_Protocol) frames at regular intervals to inform the network of device details. `lldpd` receives (and sends) the lldp frames. `lldpctl` queries the info received, and can tell us what is connected on the other end of our links.

For example, to show basic mandatory lldp info for devices connected to eth0:

	lldpctl show neighbors ports eth0 summary

### [tcpdump](http://www.tcpdump.org/manpages/tcpdump.1.html)
tcpdump monitors network interfaces and captures traffic on them for display or for later analysis.
Normally we will need superuser privileges to start a capture session.

To capture all tcp packets on a particular port to file:

	tcpdump -i eth0 -w outfile 'tcp port 9001'

Recorded dumps can be analysed with [wireshark](http://www.wireshark.org/docs/). Fairly powerful filter languages are available in both [tcpdump](http://www.tcpdump.org/manpages/pcap-filter.7.html) and [wireshark](http://wiki.wireshark.org/DisplayFilters) to help make capture and analysis more tractable. 

# Text Processing

### [grep](http://www.gnu.org/software/grep/manual/grep.html)
Searches input text for patterns and outputs matching lines.

	grep options pattern filenames
	<data grep options pattern

`-c` emit count of matched lines instead of the lines themselves.\
`-v` invert match.\
`-l` print names of files with at least one matching line.\
`-h` suppress the filename printing used when more than one file is searched.\
`-H` always print the filename in which a match is found.\
`-B num`, `-A num` in addition to the matched line, print `num` lines before or after.\
`-r` recurse into directories.\
`-E` allow extended regex (including `|` for pattern disjunction).\
`-f patternfile` obtain patterns from the given file.\
`-F` treat patterns as fixed strings delimited by newlines.

### [sed](http://man7.org/linux/man-pages/man1/sed.1.html)
Transforms streamed text.

To match all instances of `pattern` in the input and replace them with `replacement`:

	<data sed s/pattern/replacement/g

To emit only the matched group wherever it occurs:

	<data sed -n 's/prefix \(group to match\) suffix/\1/p'

`/` is the traditional separator but can be replaced by any character (e.g. to avoid the need to escape with `\`).\
`-i` or `-i .bak` to transform in place with optional backup suffix.

### [awk](http://man7.org/linux/man-pages/man1/gawk.1.html)
[AWK](http://en.wikipedia.org/wiki/AWK) named after [Aho](http://en.wikipedia.org/wiki/Alfred_Aho), [Weinberger](http://en.wikipedia.org/wiki/Peter_J._Weinberger) and [Kernighan](http://en.wikipedia.org/wiki/Brian_Kernighan).

Awk is used for filtering and processing text files by dividing them into records and fields, and providing a dsl for examining them and emitting processed data. By default, records are delimited by newlines and fields by whitespace. The awk script language is powerful and well designed for simple processing. However, it is dynamically typed and not particularly easy to test, so it is best to avoid complicated stateful processing.

The full manual for the GNU impl `gawk` is [here](http://www.gnu.org/software/gawk/manual/).

`-f scriptfile` runs awk script from a file rather than from a command line argument. Allows the awk shebang `#!/awk -f`.

### [cut](http://man7.org/linux/man-pages/man1/cut.1.html)
For when you were going to use awk to emit parts of records, without additional processing.

`-d` sets the field delimiter.\
`-f 2,3` selects fields to emit.\
`--complement` and `--output-delimiter` are self explanatory.

`cut` can also work with characters or bytes instead of fields.

### [tr](http://man7.org/linux/man-pages/man1/tr.1.html)

`tr 'abc' 'd'` replaces each occurence of a character in the first argument with the character of the corresponding index in the second argument (or the last character, if there are not enough in the second array).\
`tr -d 'abc'` deletes instead.

### [bc](http://www.gnu.org/software/bc/)
Arbitrary precision arithmetic on the command line. Input is provided as a sequence of commands to the interpreter or on stdin. Input is delimited by semicolons or newlines.

`scale` sets the number of digits operations use after the decimal point.\
`ibase` and `obase` set the base used for input and output numbers.

Letters used in variable names must be lowercase.
Additional digits used for bases higher than 10 must be uppercase.

### [wc](http://man7.org/linux/man-pages/man1/wc.1.html)
Counts lines, words and bytes on stdin or in the given files.

`-l` for line count only.\
`-w` for word count only.\
`-c` for byte count only.

### [sort](http://man7.org/linux/man-pages/man1/sort.1.html)
Emits sorted lines from stdin or the given files.

`-k fieldindex` specifies field to sort on.\
`-n` use numeric sort.

### [uniq](http://man7.org/linux/man-pages/man1/uniq.1.html)
Analyse and process input containing repeated lines from stdin.

`-c` emit a repetition count before each line.\
`-d` emit repeated lines only.\
`-u` emit non-repeated lines only.\
`-i` ignore case.

### [comm](http://man7.org/linux/man-pages/man1/comm.1.html)
Perfect tool for a few very specific use cases.

Compare two presorted files and output three columns managed as follows:

`-1` suppress the first column, lines unique to the first file.\
`-2` suppress the second column, lines unique to the second file.\
`-3` suppress the third column, lines that appear in both files.

### [join](http://man7.org/linux/man-pages/man1/join.1.html)
Joins associated lines of two files presorted on the same key field.

### [tee](http://man7.org/linux/man-pages/man1/tee.1.html)
Duplicates data on stdin by writing to stdout and to the given files.

`-a` appends instead of overwriting.

### [diff](http://man7.org/linux/man-pages/man1/diff.1.html)
Compares two files or directories.

`-y` produces two column output so diffs appear side by side.\
`-W width` sets the output max column width.\
`--suppress-common-lines` is self explanatory.

There are some occasionally useful options to ignore various kinds of whitespace changes.
`diff` output can be used as the input to `patch`.

### [patch](http://man7.org/linux/man-pages/man1/patch.1.html)
Apply a patch to files within the current working directory, assuming that the patch contains filenames that are relative to the current working directory:

	< my.diffs.patch patch -p0

# System

### [ps](http://man7.org/linux/man-pages/man1/ps.1.html)
`ps` displays information on running processes. It's one of the most common examples of a program which supports different argument styles for UNIX and BSD. By habit I tend to use BSD style.

Show processes without requiring they have the effective user id of the current user, and without requiring they have a tty, and display user-oriented output, and display the hierarchical process tree (forest):

	ps axuf

Show per process thread ids, BSD and UNIX styles:

	ps axH -O lwp
	ps -eLf

For historical reasons the term used for threads by `ps` is `**l**ight **w**eight **p**rocess`. Originally, linux only supported multithreaded processes via userspace threading libraries - to the kernel there was still only a single process. Nowadays the kernel doesn't distinguish very much between threads and processes - it has a process for each thread. In linux, threads share a thread group id (which is the return value for [getpid](http://man7.org/linux/man-pages/man2/getpid.2.html)) and have a system-unique thread id (returned by [gettid](http://man7.org/linux/man-pages/man2/gettid.2.html). See [clone](http://man7.org/linux/man-pages/man2/clone.2.html).

### [pgrep/pkill](http://man7.org/linux/man-pages/man1/pgrep.1.html)
List or signal processes selected by the given criteria.

`-f` matches against the full command line instead of just the process name.\
`-l` have `pgrep` list process names as well as ids.\
`-n` or `-o` only handle the most recently or least recently started of the matching processes.

### [kill](http://man7.org/linux/man-pages/man1/kill.1.html)
Signal processes or process groups.

`-L` list signals.\
`-s signal` specify alternative to SIGTERM.

### [killall](http://man7.org/linux/man-pages/man1/killall.1.html)
Yet another way to signal processes.

Notable on linux for options to match against process start time.

### [top](http://linux.die.net/man/1/top)
`top` observes the system and running processes in real time by displaying a sequence of snapshots.

System wide, it summarises cpu and memory activity and gives a count of processes.

`h` show help.\
`H` show threads.\
`o` change sort order (default is cpu).

The load averages displayed in the summary is read from [/proc/loadavg](http://man7.org/linux/man-pages/man5/proc.5.html) and show the number of jobs waiting for cpu time or I/O, averaged over 1, 5 and 15 minutes.

### [lsof](http://www.netadmintools.com/html/lsof.man.html)
List open files, or find processes associated with particular files. Since sockets are files, `lsof` can handle a little basic network diagnosis.

Show which process is bound to a particular port:

	lsof -i :12345

Show processes connected to a particular host and port:
	
	lsof -i@198.51.100.1:8080

Show processes which have a particular file open:

	lsof <file>

Show processes which have any files under a particular directory open:

	lsof +D <directory>

Show the files opened by a particular process:

	lsof -p <pid>

`-a` use conjuntion instead of disjunction for combining multiple selection options.\
`-n` prevent dns lookups.\
`-t` just display the pid.

For most use cases `lsof` requires superuser privileges as it needs to look at file handle tables for processes not owned by the current user.

### df
### du
### sar
### mpstat
### vmstat
### iostat
### time
### strace
### dtrace
### perf
### systemtap
### taskset, isolcpus, chkconfig, chrt
### hostname
### date
### whoami (whoami really? apue/dan script)
### uname
### group
### umask
### ulimit
### watch

# Building

### make
### gcc
### lld
### rpmbuild
### mock
